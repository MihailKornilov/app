var DIALOG={},ELM_RELOAD={},MONTH_DEF={1:"Январь",2:"Февраль",3:"Март",4:"Апрель",5:"Май",6:"Июнь",7:"Июль",8:"Август",9:"Сентябрь",10:"Октябрь",11:"Ноябрь",12:"Декабрь"},MONTH_DAT={1:"января",2:"февраля",3:"марта",4:"апреля",5:"мая",6:"июня",7:"июля",8:"августа",9:"сентября",10:"октября",11:"ноября",12:"декабря"},WEEK_NAME={0:"вс",1:"пн",2:"вт",3:"ср",4:"чт",5:"пт",6:"сб",7:"вс"},_color=function(a,c){$(document).off("mouseenter","._color td").on("mouseenter","._color td",function(){var a=$(this),
b=a.attr("val");a._tooltip(ELEM_COLOR[b][1])}).off("click","._color td").on("click","._color td",function(){var a=$(this),b=a.attr("val"),d=a.parents("._color");d.find("td").css("color","transparent");a.css("color","#fff");d.css("background-color",ELEM_COLOR[b][0]);c&&c(b)});var d="",b=0;_forIn(ELEM_COLOR,function(c,l){var g=c[0],e=l==a?"#fff":"transparent";b&&7!=b||(d+="<tr>");d+='<td class="pad5 center" style="background-color:'+g+";color:"+e+'" val="'+l+'">&#10004;';b++});return'<div class="_color" style="background-color:'+
ELEM_COLOR[a][0]+'"><table class="w200 bg-eee curP pabs">'+d+"</table></div>"},_dialog=function(a){function c(){g.remove();l.remove();ZINDEX-=10;a.dialog_id&&delete DIALOG[a.dialog_id];t()}function d(a){n._hint({msg:a,color:"red",pad:10,show:1})}a=$.extend({top:100,width:0,dialog_id:0,setup_access:0,color:"",head:"head: Название заголовка",content:'<div class="pad30 pale">content: содержимое центрального поля</div>',butSubmit:"Внести",butCancel:"Отмена",submit:function(){},cancel:c,send:{}},a);var b=
$("._dialog").length,f=_dn(!b&&a.setup_access&&"site"==_cookie("face")),f='<div class="_dialog-back"></div><div class="_dialog"><iframe class="frameD" name="frameD'+b+'"></iframe><div class="head '+a.color+'"><div class="close fr curP"><a class="icon icon-del wh pl"></a></div><div class="edit fr curP'+f+'"><a class="icon icon-edit wh pl"></a></div><div class="fs14 white">'+a.head+'</div></div><div class="content bg-fff">'+a.content+'</div><div class="btm"><button class="vk submit mr10 '+a.color+_dn(a.butSubmit)+
'">'+a.butSubmit+'</button><button class="vk cancel'+_dn(a.butCancel)+'">'+a.butCancel+"</button></div></div>",l=$("body").append(f).find("._dialog:last"),g=l.prev();l.find(".frameD");var e=l.find(".head .edit"),h=l.find(".content"),f=a.width||Math.round(h.width()),p=l.find(".btm"),n=p.find(".submit"),m=p.find(".cancel"),t=function(){},v=Math.round(f/2),F=110<VK_SCROLL?VK_SCROLL-110:0;l.find(".close").click(c);n.click(function(){n.hasClass("_busy")||(a.submit(),a.dialog_id&&delete DIALOG[a.dialog_id])});
m.click(function(){m.hasClass("_busy")||a.cancel()});e.click(function(){if(a.dialog_id){var b={op:"dialog_setup_load",dialog_id:a.dialog_id,busy_obj:e.find(".icon"),busy_cls:"spin"};_post(b,function(b){c();b.send=a.send;_dialogSetup(b)})}});$("._hint").remove();g.css({"z-index":ZINDEX+3,height:$(document).height()});l.css({width:f+"px",top:$(window).scrollTop()+F+a.top+"px",left:$(document).width()/2-v+"px","z-index":ZINDEX+5});ZINDEX+=10;_fbhs();window["frameD"+b].onresize=_fbhs;b={id:a.dialog_id,
send:a.send,D:function(a){return h.find(a)},close:c,hide:function(){g.hide();l.hide()},show:function(){g.show();l.show()},process:function(){n.addClass("_busy")},abort:function(a){n.removeClass("_busy");a&&d(a)},bottom:p,content:h,err:d,butSubmit:function(a){n[(a?"remove":"add")+"Class"]("dn");n.html(a)},butCancel:function(a){m[(a?"remove":"add")+"Class"]("dn");m.html(a)},submit:function(b){a.submit=b},go:function(){n.trigger("click")},closeFunc:function(a){t=a},post:function(a,b){a.busy_obj=n;a.busy_cls=
"_busy";a.func_err=function(a){d(a.text);$(a.attr_cmp)._flash({color:"red"}).focus()};_post(a,function(a){c();_msg();"reload"==b&&location.reload();"function"==typeof b&&b(a)})},head:function(a){l.find(".head .white").html(a)},width:function(a){v=Math.round(a/2);l.css({width:a+"px",left:$(document).width()/2-v+"px"});l.find(".head input").width(a-80)}};a.dialog_id&&(DIALOG[a.dialog_id]=b);return b},_dialogSetup=function(a){var c=_dialog({dialog_id:a.dialog_id,top:20,color:"orange",width:a.width,head:"Настройка диалогового окна #"+
a.dialog_id,content:a.html,butSubmit:"Сохранить диалоговое окно",submit:function(){a.send&&delete a.send.op;var l=$.extend({op:"dialog_setup_save",page_id:PAGE_ID,dialog_id:a.dialog_id,dialog_id_parent:b("#dialog_id_parent").val(),dialog_id_unit_get:b("#dialog_id_unit_get").val(),name:b("#dialog_name").val(),width:d,width_auto:b("#width_auto").val(),cmp_no_req:b("#cmp_no_req").val(),insert_on:b("#insert_on").val(),insert_head:b("#insert_head").val(),insert_button_submit:b("#insert_button_submit").val(),
insert_button_cancel:b("#insert_button_cancel").val(),insert_action_id:b("#insert_action_id").val(),insert_action_page_id:b("#insert_action_page_id").val(),insert_unit_id_set_elem_id:b("#insert_unit_id_set_elem_id").val(),edit_on:b("#edit_on").val(),edit_head:b("#edit_head").val(),edit_button_submit:b("#edit_button_submit").val(),edit_button_cancel:b("#edit_button_cancel").val(),edit_action_id:b("#edit_action_id").val(),edit_action_page_id:b("#edit_action_page_id").val(),del_on:b("#del_on").val(),
del_head:b("#del_head").val(),del_button_submit:b("#del_button_submit").val(),del_button_cancel:b("#del_button_cancel").val(),del_action_id:b("#del_action_id").val(),del_action_page_id:b("#del_action_page_id").val(),spisok_on:b("#spisok_on").val(),spisok_elem_id:b("#spisok_elem_id").val(),open_auto:b("#open_auto").val(),table_1:b("#table_1").val(),app_any:b("#app_any").val(),sa:b("#sa").val(),parent_any:b("#parent_any").val(),clone_on:b("#clone_on").val(),element_group_id:b("#element_group_id").val(),
element_image_id:b("#element_image_id").val(),element_width:b("#element_width").val(),element_width_min:b("#element_width_min").val(),element_type:b("#element_type").val(),element_afics:b("#element_afics").val(),element_hidden:b("#element_hidden").val(),element_action_dialog_id:b("#element_action_dialog_id").val(),menu_edit_last:b("#dialog-menu").val()},a.send||{}),g=[];_forEq(b("#element-rule input"),function(a){var b=_num(a.attr("id").split("element_rule_")[1]);a=_num(a.val());b&&a&&g.push(b)});
l.element_rule=g.join();c.post(l,function(b){a.send&&(_forIn(b.elm_js,function(a,b){ELMM[b].hint=a.hint;ELMM[b].action=a.action}),delete b.elm_js,b.send=a.send,_dialogOpen(b))})},cancel:function(){if(!a.send)return c.close();a.send.busy_obj=c.bottom.find(".cancel");a.send.busy_cls="_busy";a.send.func_open_before=function(){c.close()};_dialogLoad(a.send)},send:a.send}),d=a.width,b=c.D;b("#dialog-menu")._menu({spisok:a.menu,func:function(){_dialogHeightCorrect(b)}});b("#menu_sa")._menu({type:3,spisok:a.menu_sa});
b("#width_auto")._check({title:"автоматическая ширина"});var f={insert:"внесения",edit:"редактирования",del:"удаления"};_forN(["insert","edit","del"],function(d){b("#"+d+"_action_id")._select({width:270,title0:"действия нет, закрыть окно",spisok:a.action,func:function(a){b(".td-"+d+"-action-page")._dn(2==a);b("#"+d+"_action_page_id")._select(0)}});b("#"+d+"_action_page_id")._select({width:270,title0:"не выбрана",spisok:PAGE_LIST});b("#history_"+d).click(function(){var b=$(this);b.find("div")._vh();
_dialogLoad({dialog_id:67,dss:a.dialog_id,dop:{act:d},busy_obj:b,func_open:function(){b.find("div")._vh(1)},func_save:function(a){b.find(".pale")._dn(!a.tmp);b.find(".msg").html(a.tmp);b._flash()}})});b("#"+d+"_on")._check({func:function(a,b){b.parent().parent().next()["slide"+(a?"Down":"Up")]()}});b("#"+d+"_on_check").mouseenter(function(){$(this)._hint({pad:10,msg:"Разрешение "+f[d]+" записи",side:"left",show:1,delayShow:750})})});b("#insert_unit_change").click(function(){_dialogLoad({dialog_id:42,
dss:a.dialog_id,edit_id:a.dialog_id,busy_obj:$(this)})});b("#table_1")._select({width:170,title0:"не выбрана",spisok:a.tables});b("#element_group_id")._select({title0:"нет",width:230,spisok:a.group,func:function(a){b(".elememt-setup")["slide"+(a?"Down":"Up")]()}});b("#element_width")._count({width:60,step:10});b("#element_width_min")._count({width:60,step:10});b("#element_type")._select({title0:"не указан",width:100,spisok:a.col_type});b("#element_action_dialog_id")._select({width:280,title0:"не указан",
spisok:a.dlg_func});b("#spisok_on")._check({func:function(a){b(".tr-spisok-col")._dn(a)}});b("#open_auto")._check({func:function(a){b("#tr-open-auto")._dn(a)}});b("#open_filter").click(function(){_dialogLoad({dialog_id:41,dss:a.dialog_id,busy_obj:$(this),busy_cls:"hold",func_save:function(a){}})});b("#spisok_elem_id")._select({width:250,title0:"не указана",spisok:a.spisok_cmp});b("#dialog_id_parent")._select({width:250,title0:"нет",spisok:a.dlg_spisok_on});b("#dialog_id_unit_get")._select({width:250,
title0:"нет",spisok:a.dlg_unit_get});b("#IUID_dlg_id")._select({width:250,title0:"диалог не выбран",spisok:a.dlg_spisok_on,func:function(a){b(".tr-iuid")._dn(a);b("#insert_unit_id_set_elem_id")._select(0);a&&(b("#insert_unit_id_set_elem_id")._select("process"),_post({op:"dialog_setup_cols",dialog_id:a},function(a){b("#insert_unit_id_set_elem_id")._select("spisok",a.spisok)}))}});b("#insert_unit_id_set_elem_id")._select({width:250,title0:"колонка не выбрана",spisok:a.iuid_cols});b("form input").change(function(){var a=
b("#element_image_id"),d=a.next(),e=new XMLHttpRequest,c=new FormData;d.addClass("_busy");e.open("post",AJAX,!0);c.append("f1",this.files[0]);c.append("op","element_image_upload");e.send(c);e.addEventListener("load",function(){d.removeClass("_busy");var b=JSON.parse(e.responseText);b.success?(a.val(b.img_id),d.addClass("loaded").find("img").remove(),d.find(".eimg").append(b.html)):d._hint({msg:b.text,pad:10,color:"red",show:1})})});b(".eimg-del").click(function(){b(".el-img").removeClass("loaded").prev().val(0)});
_dialogHeightCorrect(b);b("#dialog-w-change").css("left",d+8+"px").draggable({axis:"x",grid:[10,0],drag:function(l,g){b("#width_auto")._check(0);var e=g.position.left-8;if(e<a.width_min||980<e)return!1;d=e;c.width(e);b("#dialog-width").html(e);b(".dw").html(e)}})},_dialogHeightCorrect=function(a){var c=a("#dialog-w-change").parent().height();a("#dialog-w-change").height(c)},_dialogLoad=function(a){var c=$.extend({op:"dialog_open_load",page_id:PAGE_ID,dialog_id:0,dss:0,block_id:0,element_id:0,get_id:0,
edit_id:0,del_id:0,dop:"",busy_obj:null,busy_cls:"_busy",func_open_before:function(){},func_open:function(){},func_save:null},a);a=_copyObj(c);_post(c,function(d){d.send=a;a.func_open_before(d,b);var b=_dialogOpen(d);a.func_open(d,b)})},_dialogOpen=function(a){if(a.del_id)return _dialogOpenDel(a);a.send.dialog_id=a.dialog_id;var c=_dialog({dialog_id:a.dialog_id,top:20,width:a.width,setup_access:a.setup_access,head:a.head,content:a.html,butSubmit:a.button_submit,butCancel:a.button_cancel,submit:function(){var d=
{op:a.edit_id?"spisok_save":"spisok_add",page_id:PAGE_ID,dialog_id:a.dialog_id,dss:a.srce.dss,block_id:a.srce.block_id,element_id:a.srce.element_id,unit_id:a.edit_id,cmp:{},vvv:{}};_forIn(a.vvv,function(b,c){var l=ELMM[c],g=_attr_cmp(c);switch(l.dialog_id){case 12:var e=l.txt_1+"_get";window[e]&&(d.vvv[c]=window[e](l,a));break;case 29:if(!l.num_7)break;d.vvv[c]=g._select("inp")}g&&(d.cmp[c]=g.val())});c.post(d,function(b){if(!a.send.func_save||a.send.func_save(b))_dialogOpenSubmitAction(b),b.elem_js&&
(ELMM[b.unit.id]=b.elem_js,0<b.unit.block_id&&(BLKK[b.unit.block_id].elem_id=b.unit.id)),43==a.dialog_id&&(ELMM[b.unit.element_id].hint={id:b.unit.id,on:b.unit.on})})},send:a.send});a.dlg=c;_ELM_ACT(a);return c},_dialogOpenDel=function(a){var c=_dialog({dialog_id:a.dialog_id,top:20,width:a.width,setup_access:a.setup_access,color:"red",head:a.head,content:a.html,butSubmit:a.button_submit,butCancel:a.button_cancel,submit:function(){c.post({op:"spisok_del",dialog_id:a.dialog_id,dss:a.send.dss,unit_id:a.del_id},
_dialogOpenSubmitAction)},send:a.send});return c},_dialogOpenSubmitAction=function(a){switch(a.action_id){case 1:location.reload();break;case 2:var c=URL+"&p="+a.action_page_id;a.unit&&(c+="&id="+a.unit.id);location.href=c;break;case 3:c="#block-level-"+a.obj_name;$(c).after(a.level).remove();$(c).find(".block-grid-on").removeClass("grey").trigger("click");break;case 4:var d=_num(a.dss4);if(!d)break;if(!DIALOG[d])break;c=DIALOG[d].send;c.func_open_before=function(){DIALOG[d].close()};_dialogLoad(c)}a.elem_del&&
(BLKK[ELMM[a.elem_del].block_id].elem_id=0,delete ELMM[a.elem_del])},ATTR_EL=function(a,c){return(c?"":"#")+"el_"+a},_attr_el=function(a){a=$(ATTR_EL(a));return a.length?a:!1},ATTR_CMP=function(a){return"#cmp_"+a},_attr_cmp=function(a,c){var d=ELMM[a],d=c&&d.afics?d.afics:"",d=$(ATTR_CMP(a)+d);return d.length?d:!1},ATTR_BL=function(a){return"#bl_"+a},_attr_bl=function(a){a=$(ATTR_BL(a));return a.length?a:!1},_ELM_ACT=function(a){if(!a.dlgerr){var c=a.unit,d;_forIn(a.vvv,function(b,g){g*=1;var e=ELMM[g];
if(!e)throw"несуществующий элемент "+g;e.id=g;var h=_attr_cmp(g),f=_attr_cmp(g,1),n=_attr_el(g);if(n.length)switch(_elemHint(e),e.dialog_id){case 1:if(!e.action)break;h._check({func:function(a){_elemAction(e,a)}});_elemAction(e,_num(h.val()),1);break;case 5:h._autosize();break;case 6:_elemAction(e,_num(h.val()),1);var m=_copySel(PAGE_LIST);1959==g&&m.unshift({id:3,title:"Автоматически",content:'<b class="color-pay">Автоматически</b>'});h._select({width:_num(e.width),title0:e.txt_1,spisok:m,func:function(a){_elemAction(e,
a)}});break;case 7:d=h;var t=0,v=FILTER[e.num_1][g],F=function(a){t=1;FILTER[e.num_1][g]=a;_spisokUpdate(e.num_1,function(){t=0;v!=a&&F(v)})};h._search({func:function(a){v!=a&&(v=a,t||F(a))}});break;case 12:if(!window[e.txt_1])break;window[e.txt_1](e,b,a);break;case 13:var m=h.next(),q=m.find(".inp"),u=m.find(".icon-del");if(q.attr("disabled"))break;m.click(function(){var b=0;if(e.num_1&&(b=_num(a.dlg.D(ATTR_CMP(e.num_1)).val()),!b)){_attr_cmp(e.num_1,1)._flash({color:"red"});_attr_cmp(g,1)._hint({msg:"Не выбрано значение",
color:"red",pad:10,show:1});return}_dialogLoad({dialog_id:11,block_id:a.srce.block_id,dss:a.srce.dss,dop:{mysave:1,is13:g,nest:_num(e.num_5),sev:_num(e.num_6),dlg24:b,sel:h.val(),allow:e.num_2?e.txt_2:""},busy_obj:q,busy_cls:"hold",func_save:function(a){h.val(a.v);q.val(a.title);u._dn(1);_elemReload(e,a)}})});u.click(function(a){a.stopPropagation();h.val(0);q.val("");u._dn();_elemReload(e)});break;case 16:if(!e.action)break;h._radio({func:function(a){_elemAction(e,a)}});_elemAction(e,_num(h.val()),
1);break;case 17:_elemAction(e,_num(h.val()),1);h._select({width:_num(e.width),title0:e.txt_1,spisok:b,func:function(a){_elemAction(e,a)}});break;case 18:_elemAction(e,_num(h.val()),1);h._dropdown({title0:e.txt_1,title0_hide:e.num_1,nosel:e.num_2,spisok:b,func:function(a){_elemAction(e,a)}});break;case 23:6161==e.num_8&&n.find("ol:first").nestedSortable({forcePlaceholderSize:!0,placeholder:"nested-placeholder",listType:"ol",items:"li",handle:".icon-move",isTree:1<e.num_7,maxLevels:e.num_7,tabSize:30,
revert:200,start:function(a,b){var e=$(b.item).find("._stab:first").width();$(b.placeholder).width(e)},update:function(a,b){var e={op:"spisok_23_sort",elem_id:g,arr:$(this).nestedSortable("toArray"),busy_obj:n,busy_cls:"spisok-busy"};_post(e)},expandedClass:"pb10",errorClass:1<e.num_7?"bg-fcc":""});_forN(b,function(a){if(91==a.dialog_id)return _forEq(n.find("._check"),function(b){"all"==b.attr("id").split("_")[1]?$("#sch"+a.id+"_all")._check({func:function(a){_forEq(n.find("._check"),function(b){b=
b.prev();"all"!=b.attr("id").split("_")[1]&&b._check(a)})}}):b.prev()._check()}),!1});break;case 24:_elemAction(e,_num(h.val()),1);h._select({width:_num(e.width),title0:e.txt_1,spisok:b,func:function(a){_elemAction(e,a)}});break;case 26:h._select({width:_num(e.width),title0:e.txt_1,spisok:b});break;case 28:var m=n.find("._attach"),B=m.find(".atup"),S=m.find(".vk"),ga=m.find("form"),N=m.find(".at-file"),G=m.find(".atv"),T;m.find(".icon-del-red").click(function(){B._dn(1);G._dn();h.val(0)});N.change(function(){N._vh();
S.addClass("_busy");_cookie("_attached",0);_cookie("_attached_id",0);T=setInterval(ha,500);ga.submit()});var ha=function(){switch(_num(_cookie("_attached"))){case 1:var a=_cookie("_attached_id");B._dn();G._dn(1).find("td").html("&nbsp;");h.val(a);_post({op:"attach_get",id:a,busy_obj:G},function(a){G.find("td").html(a.html)});case 2:case 3:N._vh(1),S.removeClass("_busy"),clearInterval(T)}};break;case 29:_elemAction(e,_num(h.val()),1);m={width:_num(e.width),title0:e.txt_1,write:e.num_1&&e.num_3,msg_empty:"Не найдено",
spisok:b,blocked:e.num_4,func:function(a){_elemAction(e,a)},funcWrite:function(a,b){_post({op:"spisok_29_connect",cmp_id:g,v:a,busy_obj:b.icon_del,busy_cls:"spin"},function(a){b.spisok(a.spisok)})}};e.num_2&&(m.funcAdd=function(a){_dialogLoad({dialog_id:e.num_1,busy_obj:a.icon_add,busy_cls:"spin",func_save:function(b){a.unitUnshift({id:b.unit.id,title:b.unit.txt_1});a.value(b.unit.id)}})});h._select(m);break;case 31:$(document).on("click",ATTR_EL(g)+" ._check",function(){var a=[];_forEq(n.find("._check.on"),
function(b){a.push(b.prev().attr("id").split("_")[1])});a.length&&(a.unshift(0),a.push(0));h.val(a.join())});break;case 35:m={width:_num(e.width),again:e.num_8};3681==e.num_1&&(m.min=e.num_2?_num(e.num_3):!1,m.max=e.num_5?_num(e.num_6):!1,m.step=_num(e.num_7),m.minus=_num(e.num_4));3682==e.num_1&&b&&(m.step=b.ids,m.title=b.title);h._count(m);break;case 37:h._select({width:_num(e.width),title0:"не выбрано",msg_empty:"колонок нет",spisok:b,funcAdd:function(a){_dialogLoad({dialog_id:22,block_id:e.block_id,
busy_obj:a.icon_add,busy_cls:"spin",func_save:function(b){a.unitUnshift(b);a.value(b.id)}})}});break;case 38:h._select({width:_num(e.width),title0:e.txt_1,msg_empty:"диалоги ещё не были созданы",spisok:b});break;case 39:var U=$(ATTR_CMP(g)+"_mon"),V=$(ATTR_CMP(g)+"_year"),C=function(){var a=_num(U.val());h.val(V.val()+"-"+(9<a?"":"0")+a)};U._count({width:100,step:[1,2,3,4,5,6,7,8,9,10,11,12],title:"январь февраль март апрель май июнь июль август сентябрь октябрь ноябрь декабрь".split(" "),again:1,
func:C});V._count({width:70,min:1970,max:2100,func:C});break;case 40:var m=h.next(),q=m.find(".inp"),u=m.find(".icon-del"),ia=function(b,e){if(e)return e;if(!b)return 0;var d=_idsFirst(a.dlg.D(ATTR_CMP(b)).val());return d?d:(_attr_cmp(b,1)._flash({color:"red"})._hint({msg:"Не выбрано значение",color:"red",pad:10,side:"left",show:1}),0)},ja=function(b){if(b)return b;b=a.srce.block_id;if(!b)return 0;b=BLKK[b];return b?"spisok"==b.obj_name?(b=ELMM[b.obj_id])&&14==b.dialog_id?b.num_1:0:0:0};if(q.attr("disabled"))break;
m.click(function(){var d=ia(e.num_1,b);(d=ja(d))&&_dialogLoad({dialog_id:41,block_id:a.srce.block_id,element_id:e.num_1,dss:d,dop:h.val(),busy_obj:q,busy_cls:"hold",func_save:function(a){h.val(a.v);q.val(a.title);u._dn(1)}})});u.click(function(a){a.stopPropagation();h.val("");q.val("");u._dn()});break;case 45:var x=h.next(),H=function(){var a=[],b=0,d=0,c="";_forEq(x.find(".uinp"),function(c){var h=_num(c.attr("val"));if(h){var g=_cena(c.val()),f=0;b+=g;e.num_4&&(f=_cena(c.closest("tr").find(".ucena").html()),
d+=f*g,console.log(d));a.push(h+":"+g+":"+f)}});h.val(a.join());if(a.length){var g=_cena(d),c='Всего <b class="fsin">'+_cena(b)+"</b> позици"+_end(b,["я","и","й"])+(e.num_4?' на сумму <b class="fsin">'+g+"</b> руб.":"");e.num_5&&_attr_cmp(e.num_5).val(g)}n.find(".uns-itog").html(c)},W=function(){x.find(".icon").click(function(){$(this).closest("tr").remove();x.find("tr").length||x.html("");H()});x.find(".uinp").keyup(H)};W();H();f.click(function(){e.num_2&&_dialogLoad({block_id:e.block_id,dialog_id:e.num_2,
busy_obj:f,func_open:function(a,b){b.content.click(function(a){a=$(a.target).parents(".sp-unit");a.length&&(a=_num(a.attr("val")))&&(b.close(),a={op:"spisok_45_uns",elem_id:g,id_new:a,v:h.val(),busy_obj:f},_post(a,function(a){x.html(a.html);W();H();x.find(".uinp:last").select()}))})}})});break;case 49:m=h.next();q=m.find(".inp");u=m.find(".icon-del");m.click(function(){_dialogLoad({dialog_id:19,block_id:a.srce.block_id,dop:{sel:h.val()},busy_obj:q,busy_cls:"hold",func_save:function(a){h.val(a.ids);
q.val(a.title);u._dn(a.ids)}})});u.click(function(a){a.stopPropagation();h.val(0);q.val("");u._dn()});break;case 51:h._calendar({lost:e.num_1,time:e.num_2,func:function(){_elemAction(e,1)}});break;case 52:if(!n.length)break;var D=0,s=n.find("._note"),m=s.attr("val").split(":"),ka=_num(m[0]),la=_num(m[1]),I=s.find("._note-txt"),J=I.find("textarea"),X=I.width(),Y=function(){s.find("._note-list textarea").keyup(function(a){if(13==a.keyCode){switch(e.num_2){case 9644:if(event.ctrlKey){this.value+="\n";
$(this)._autosize("update");return}break;case 9645:if(!event.ctrlKey)return;break;default:return}$(this).parents("._note-comment").find(".comment-ok").trigger("click")}});s.find(".comment-ok").click(function(){var a=$(this),b=a.parents("._note-comment"),d=a.parents("._note-u"),e=b.find("textarea"),c=$.trim(e.val());if(!c)return e.focus();b={op:"note_comment_add",elem_id:g,note_id:d.attr("val"),txt:c,busy_cls:"busy",busy_obj:b};_post(b,function(b){a.closest("TABLE").before(b.html);e.val("");e._autosize("update")})});
s.find("._note-to-cmnt").click(function(){var a=$(this);a.next().show();a.parents("._note-u").find("textarea").focus();a.remove()});s.find(".note-del").click(function(){var a=$(this),b=a.parents("._note-u"),a={op:"note_del",note_id:b.attr("val"),busy_cls:"spin",busy_obj:a};_post(a,function(){b.addClass("deleted")})});s.find(".note-rest").click(function(){var a=$(this),b=a.parents("._note-u"),a={op:"note_rest",note_id:b.attr("val"),busy_obj:a};_post(a,function(){b.removeClass("deleted")})})};s.find("textarea")._autosize();
J.keyup(function(a){if(13==a.keyCode)switch(e.num_2){case 9644:if(event.ctrlKey){this.value+="\n";$(this)._autosize("update");return}return s.find(".note-ok").trigger("click");case 9645:if(!event.ctrlKey)break;return s.find(".note-ok").trigger("click")}var b=$.trim(J.val());D&&clearInterval(D);D=setInterval(function(){I.stop().animate({width:X-(b.length?33:0)},150);clearInterval(D);D=0},300)});s.find(".note-ok").click(function(){var a=$.trim(J.val());a&&_post({op:"note_add",elem_id:g,page_id:ka,obj_id:la,
txt:a,busy_cls:"busy",busy_obj:s},function(a){J.val("")._autosize("update");I.width(X);s.find("._note-list").html(a.html);Y()})});Y();break;case 57:var ma="57_"+g;toggle=function(a){_forN(b,function(b){_forN(_elemFuncBlockObj(_idsAss(b.blk)),function(e){if(e.obj.length)e.obj[b.id==a?"show":"hide"]()})});_cookie(ma,a)};toggle(_num(h.val()));h._menu({type:{1158:2,1159:3}[e.num_1],spisok:b,func:toggle});break;case 59:_elemAction(e,_num(h.val()),1);var K=f.next(),na=function(a){_post({op:"spisok_59_unit",
cmp_id:g,unit_id:a,busy_obj:f},function(b){K.find(".un-html").html(b.html);K._dn(1);f._dn();_elemAction(e,a)})};if(e.num_3)break;f.click(function(){_dialogLoad({block_id:e.block_id,dialog_id:e.num_4,busy_obj:f,func_open:function(a,b){b.content.click(function(a){a=$(a.target).parents(".sp-unit");a.length&&(a=_num(a.attr("val")))&&(h.val(a),b.close(),na(a))})}})});K.find(".icon").click(function(){f._dn(1);K._dn();h.val(0);_elemAction(e,0)});break;case 60:var r=n.find("._image-load"),oa=n.find("._image-prc"),
Z=n.find(".ii4"),z=function(){var a=h.val().split(","),b=[],e=!0;_forN(a,function(b,e){0<b&&(a[e]=-1*b)});_forEq(n.find("dd.curM"),function(e){var d=_num(e.attr("val"));b.push(d);_forN(a,function(b,e){if(d==Math.abs(b))return delete a[e],!1})});_forN(a,function(a){a&&(b.push(a),e=!1)});Z._dn(!e,"empty");h.val(b.join(","));n.find(".icon-off").off("click");n.find(".icon-off").on("click",function(a){a.stopPropagation();var b=$(this).parent();$(this).remove();b.animate({width:0},300,function(){b.remove();
z()})})},O=function(a){var b=new XMLHttpRequest;(b.upload||b).addEventListener("progress",function(a){a=Math.round((a.position||a.loaded)/(a.totalSize||a.total)*100);100==a?r.removeClass("progress"):(oa.html(a+"%"),r.addClass("progress"))});b.addEventListener("load",function(){r.removeClass("busy");var a=JSON.parse(b.responseText);a.success?(r.parent().before(a.html),z()):r._hint({msg:a.text,pad:10,color:"red",show:1})});b.open("post",AJAX,!0);var e=new FormData;e.append("f1",a);e.append("op","image_upload");
b.send(e)};z();n.find("dl").sortable({items:".curM",placeholder:"ui-hold",update:z});n.find(".tab-load td").mouseenter(function(){var a=$(this),b="Выбрать картинку из файлов.<br>Размер не менее 100х100 пикс.<br>Размер файла не более 15 мб.";a.hasClass("ii2")&&(b="Указать ссылку на изображение");a.hasClass("ii3")&&(b="Сделать фото с вебкамеры");a.hasClass("ii4")&&(a.hasClass("empty")?b="Удалённых изображений нет":(b=_num(a.attr("val")),b="Удалено "+b+" изображени"+_end(b,["е","я","й"])+".<br>Нажмите для просмотра."));
a._hint({msg:b,pad:10,show:1,delayShow:1E3})});n.find("form input").change(function(){r.addClass("busy");O(this.files[0])});var A=n.find("._image-link"),y=A.find("input"),aa=A.find(".icon-ok"),m=function(){var a={op:"image_link",obj_name:"elem_"+g+"_"+USER_ID,obj_id:_num(c.id),url:$.trim(y.val()),busy_obj:aa,busy_cls:"spin"};a.url.length?_post(a,function(a){y.val("");r.parent().before(a.html);z();y.focus()}):y.focus()};n.find(".ii2").click(function(){r.addClass("dis");A.slideDown(200);y.val("").focus()});
A.find(".icon-del").click(function(){r.removeClass("dis");A.slideUp(200)});y._enter(m);aa.click(m);y[0].addEventListener("paste",function(a){if(a.clipboardData){var b;_forN(a.clipboardData.items,function(a){if("image"==a.type.substr(0,5))return b=a.getAsFile(),!1});b&&(r.removeClass("dis"),r.addClass("busy"),A.slideUp(200),O(b))}});n.find(".ii3").click(function(){_dialogLoad({dialog_id:61,busy_obj:r,busy_cls:"busy",func_open:function(a,b){var e=b.content.find("embed")[0];b.submit(function(){for(var a=
e._snap().replace(/[^A-Za-z0-9\+\/]/g,""),d=a.length,c=3*d+1>>2,h=new Uint8Array(c),g,f=0,l=0,n=0;n<d;n++){g=n&3;var p=a.charCodeAt(n),f=f|(64<p&&91>p?p-65:96<p&&123>p?p-71:47<p&&58>p?p+4:43===p?62:47===p?63:0)<<18-6*g;if(3===g||1===d-n){for(g=0;3>g&&l<c;g++,l++)h[l]=f>>>(16>>>g&24)&255;f=0}}a=new Blob([h],{type:"image/jpeg"});O(a);r.addClass("busy");b.close()})}})});Z.click(function(){$(this).hasClass("empty")||_dialogLoad({dialog_id:63,dop:h.val(),busy_obj:r,busy_cls:"busy",func_open:function(a,
b){b.content.find(".icon-recover").click(function(){var a=$(this),b={op:"image_recover",id:a.attr("val"),busy_obj:a,busy_cls:"spin"};_post(b,function(b){a.parent().remove();r.parent().before(b.html);z()})})}})});break;case 62:h._check({func:function(a){_elemAction(e,a);FILTER[e.num_1][g]=a;_spisokUpdate(e.num_1)}});e.action&&_elemAction(e,FILTER[e.num_1][g],1);break;case 66:m=_color(h.val(),function(a){h.val(a)});h.next().remove("._color");h.after(m);break;case 70:h.next()._hint({msg:b,pad:3,side:"right",
func:function(a){var b=a.find("._color-bg-choose div");b.click(function(){var a=$(this),e=a.attr("val");b.removeClass("sel");a.addClass("sel");h.val(e).next().css("background-color",e)})}});break;case 72:var P=$(ATTR_CMP(g)+"yl"),L=$(ATTR_CMP(g)+"rd"),ba=P.val(),C=function(){var a=_num(L.val()),a=P.val()+"-"+(9<a?"":"0")+a;h.val(a);FILTER[e.num_1][g]=a;_spisokUpdate(e.num_1)};P._yearleaf({func:function(a){L._radio(ba<a?1:12);C();ba=a;_post({op:"spisok_72_sum",elem_id:g,year:a},function(a){L._radio("spisok",
_toSpisok(a.spisok))})}});L._radio(C);break;case 74:if(!h)break;h._radio({func:function(a){FILTER[e.num_1][g]=a;_spisokUpdate(e.num_1)}});break;case 75:n.find(".u75").click(function(){var a=$(this),b=a.closest("td").find("a").html()+" » "+a.html();n.find(".pname75").html(b);n.find(".mp75")._dn(!0);n.find(".tab75")._dn();FILTER[e.num_1][g]=a.attr("val");_spisokUpdate(e.num_1)});n.find(".icon-del").click(function(){n.find(".mp75")._dn();n.find(".tab75")._dn(!0);FILTER[e.num_1][g]=0;_spisokUpdate(e.num_1)});
break;case 77:var w=n.find("._filter-calendar"),M=w.find(".fc-cnt");w.find(".laquo").click(function(){var a={op:"filter_calendar_mon_change",elem_id:g,mon:w.find(".mon-cur").val(),side:$(this).attr("val"),busy_cls:"busy",busy_obj:w};_post(a,function(a){w.find(".mon-cur").val(a.mon);w.find(".td-mon").html(a.td_mon);M.html(a.cnt)})});w.click(function(a){a=$(a.target);a.hasClass("monn")&&(M.find(".sel").removeClass("sel"),a.addClass("sel"),FILTER[e.num_1][g]=a.attr("val"),_spisokUpdate(e.num_1))});M.click(function(a){a=
$(a.target);var b=a.hasClass("on"),d=a.hasClass("week-num"),c=b?a:a.parent();if(b||d)w.find(".monn.sel").removeClass("sel"),M.find(".sel").removeClass("sel"),c.addClass("sel"),FILTER[e.num_1][g]=a.attr("val"),_spisokUpdate(e.num_1)});break;case 78:var ca=n.find(".fm-unit");n.find(".fm-plus").click(function(){var a=$(this),b="+"==a.html();a.closest("TABLE").next()["slide"+(b?"Down":"Up")](200);a.html(b?"-":"+")});ca.click(function(){var a=$(this),b=a.hasClass("sel");ca.removeClass("sel");b||a.addClass("sel");
FILTER[e.num_1][g]=b?0:a.attr("val");_spisokUpdate(e.num_1)});break;case 80:h.click(function(){var a=$(this);_post({op:"spisok_filter_clear",spisok_id:e.num_1,busy_obj:a},function(b){a._dn();for(var e in b.upd){var d=b.upd[e];_attr_el(d.id).html(d.html)}_forIn(b.def,function(a){switch(a.dialog_id){case 7:_attr_cmp(a.elem_id)._search("clear");break;case 62:_attr_cmp(a.elem_id)._check(a.v);break;case 74:_attr_cmp(a.elem_id)._radio(a.v);break;case 75:_attr_el(a.elem_id).find(".mp75")._dn();_attr_el(a.elem_id).find(".tab75")._dn(!0);
break;case 77:var b=_attr_el(a.elem_id).find("._filter-calendar");b.find(".mon-cur").val(a.dop.mon);b.find(".td-mon").html(a.dop.td_mon);b.find(".fc-cnt").html(a.dop.cnt);break;case 78:_attr_el(a.elem_id).find(".sel").removeClass("sel");break;case 83:_attr_cmp(a.elem_id)._select(0);break;case 102:_attr_el(a.elem_id).find(".holder")._dn(1),_attr_el(a.elem_id).find(".td-un").html('<div class="icon icon-empty"></div>'),_attr_el(a.elem_id).find(".icon-del")._vh()}});FILTER=b.filter})});break;case 83:h._select({width:_num(e.width),
title0:e.txt_1,spisok:b,func:function(a){FILTER[e.num_1][g]=a;_spisokUpdate(e.num_1)}});break;case 85:h._select({width:_num(e.width),title0:e.txt_1,spisok:b,msg_empty:e.num_1?"Список пуст":"Не указан список",func:function(a){}});ELM_RELOAD[e.num_1]=e.id;break;case 88:_forN(b,function(a){if(91==a.dialog_id)return _forEq(n.find("._check"),function(b){"all"==b.attr("id").split("_")[1]?$("#sch"+a.id+"_all")._check({func:function(a){_forEq(n.find("._check"),function(b){b=b.prev();"all"!=b.attr("id").split("_")[1]&&
b._check(a)})}}):b.prev()._check()}),!1});break;case 92:if(c.id)break;var Q=[],da={};_forIn(b,function(a){da[a.elm_id]||(da[a.elm_id]=1,_forEq(_attr_el(a.elm_id).find("._check"),function(a){a=a.prev();var b=a.attr("id").split("_")[1];"all"!=b&&_num(a.val())&&Q.push(b)}))});h.val(Q.join());m={op:"spisok_92_sum",elem_id:g,ids:Q.join(),func_err:function(){_forIn(b,function(a){$("#el92_"+a.dlg_id).parent().find(".sum92").html("")})}};_post(m,function(a){console.log(a.data);var b=0,e=0;_forIn(a.data,function(a,
d){$("#el92_"+d).html(a.count?a.count:"").parent().find(".sum92").html(a.sum?a.sum:"");b+=a.count;e+=a.sum});n.find(".itog-c").html(b);n.find(".itog-sum").html(e)});break;case 102:n._filter102();break;case 300:var m=h.next(),q=m.find("input"),R=m.find(".icon-vk"),E=q.next(),ea,fa=h.val();q.keyup(function(){var a=$(this);(a=$.trim(a.val()))?_post({op:"vk_user_get",val:a,busy_obj:R,busy_cls:"spin",func_err:function(a){E.html('<div class="mt10 red">'+a.text+"</div>")}},function(a){E.html(a.html);ea=
a.sel;fa=a.user_id}):E.html("")});$(document).off("click",ATTR_EL(e.id)+" button").on("click",ATTR_EL(e.id)+" button",function(){E.html(ea);q._dn();R._dn();h.val(fa)}).off("click",ATTR_EL(e.id)+" .icon-del-red").on("click",ATTR_EL(e.id)+" .icon-del-red",function(){E.html("");R._dn(1);h.val(0);q.val("")._dn(1).focus()});break;case 400:$("#chart_"+g).height(300).width(window["WIDTH_"+g]).highcharts({chart:{type:"column"},title:{text:e.txt_1},xAxis:{categories:window["CAT_"+g],labels:{style:{color:"#333"}}},
yAxis:{title:{text:"Количество"},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:"black"}}},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1}}},series:window["SERIES_"+g]});break;case 401:$("#chart_"+g).height(300).width(window["WIDTH_"+g]).highcharts({chart:{type:"line"},title:{text:e.txt_1},xAxis:{categories:window["CAT_"+g],labels:{style:{color:"#333"}}},yAxis:{title:{text:"Сумма"},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:"black"}}},plotOptions:{column:{stacking:"normal",
dataLabels:{enabled:!1}}},series:window["SERIES_"+g]})}});var b=!1,f;_forIn(a.vvv,function(a,d){if(ELMM[d].focus)return f=_attr_cmp(d).val().length,_attr_cmp(d).focus(),_attr_cmp(d)[0].setSelectionRange(f,f),b=!0,!1});!b&&d&&(f=d.val().length,d.focus(),d[0].setSelectionRange(f,f))}},_elemHint=function(a){if(a.hint){var c=a.hint,d={0:"auto",755:"top",756:"bottom",757:"left",758:"right"},b={755:"h",756:"h",757:"v",758:"v"},f={767:"center",768:"left",769:"right",772:"center",773:"top",774:"bottom"};
_attr_el(a.id).mouseenter(function(){var a={msg:_br(c.msg,1),pad:10,side:d[c.side],show:1,delayShow:c.delay_show,delayHide:c.delay_hide};c.side&&(a.objPos=f[c["pos_"+b[c.side]]]);$(this)._hint(a)})}},_elemAction=function(a,c,d){a.action&&_forN(a.action,function(b){switch(b.dialog_id){case 201:var f=0;switch(b.apply_id){case 2784:f=1}if(!b.initial_id)break;if(c&&-2!=b.initial_id&&b.initial_id!=c)if(b.revers)f=f?0:1;else break;if(!c&&-1!=b.initial_id)if(b.revers)f=f?0:1;else break;_forN(_elemFuncBlockObj(b.target_ids),
function(a){if(a.obj.length)switch(b.effect_id){case 44:case 715:case 2789:if(d){a.obj._dn(f,"vh");a.obj.css({opacity:f});break}a.obj._dn(1,"vh");a.obj.animate({opacity:f},300,function(){a.obj._dn(f,"vh")});break;case 45:case 716:case 2790:if(!a.slide){a.obj._dn(f,"vh");break}if(d){a.obj[f?"show":"hide"]();break}a.obj["slide"+(f?"Down":"Up")](300);break;default:if(!a.slide){a.obj._dn(f,"vh");break}a.obj[f?"show":"hide"]()}});break;case 202:var l=-1==b.apply_id?0:1;switch(b.initial_id){case -1:if(c&&
b.revers){l=l?0:1;break}if(c)return;break;case -2:if(!c&&b.revers){l=l?0:1;break}if(!c)return;break;default:if(!c||c!=b.initial_id)return;c=b.apply_id}_forIn(_idsAss(b.target_ids),function(b,d){switch(ELMM[d].dialog_id){case 1:_attr_cmp(d)._check(l)._check(l);break;case 29:_attr_cmp(d)._select(c);break;case 62:_attr_cmp(d)._check(l),FILTER[a.num_1][d]=l}});case 205:if(d)break;if(c!=b.initial_id)break;var g=_num(b.target_ids);if(!g)break;g={dialog_id:g,get_id:b.apply_id?GET_ID:0,edit_id:b.effect_id?
GET_ID:0,busy_obj:_attr_bl(ELMM[a.id].block_id)};_dialogLoad(g);break;case 206:l=0;switch(b.initial_id){case -2:l=1}g=_num(b.target_ids);if(!g)break;if(29==ELMM[g].dialog_id)return _attr_cmp(g)._select("focus");_attr_cmp(g).focus();case 207:if(d)break;if(c!=b.initial_id)break;g=_num(b.target_ids);if(!g)break;location.href=URL+"&p=9&doc_id="+g+(GET_ID?"&id="+GET_ID:"")}})},_elemFuncBlockObj=function(a){"object"!=typeof a&&(a=_idsAss(a));var c=[],d=_copyObj(a),b=$;_forIn(d,function(a,l){if(a){var g=
BLKK[l];if(g){var e=b(ATTR_BL(l));if(1==g.xx)c.push({obj:e.closest(".bl-div"),slide:1});else{var h=1;_forIn(g.xx_ids,function(a,b){if(!d[b])return h=0,!1});h?(_forIn(g.xx_ids,function(a,b){d[b]=0}),c.push({obj:e.closest(".bl-div"),slide:1})):c.push({obj:e,slide:0})}}}});return c},_elemReload=function(a,c){ELM_RELOAD[a.id]&&_attr_cmp(ELM_RELOAD[a.id])._select(0)._select("spisok",c?c.spisok:[])},_blockActionJS=function(a,c,d,b){if(BLKK[c]){var f=BLKK[c];f.action&&_forN(f.action,function(f){if(!b[f.id])switch(f.dialog_id){case 211:var g=
0;switch(f.apply_id){case 3167:g=1}f.revers&&(f.on&&(g=g?0:1),f.on=f.on?0:1);_forN(_elemFuncBlockObj(f.target_ids),function(a){if(a.obj.length)switch(f.effect_id){case 3171:a.obj._dn(1,"vh");a.obj.animate({opacity:g},300,function(){a.obj._dn(g,"vh")});break;case 3172:if(!a.slide){a.obj._dn(g,"vh");break}a.obj["slide"+(g?"Down":"Up")](300);break;default:if(!a.slide){a.obj._dn(g,"vh");break}a.obj[g?"show":"hide"]()}});break;case 212:var e=_num(f.target_ids),h=_attr_cmp(e),e=ELMM[e],p=f.apply_id;if(!e)break;
if(!p)break;-1==p&&(p=0);switch(e.dialog_id){case 1:h.next().hasClass("php")&&h._check();h._check(p);return;case 29:h._select(p);return}break;case 213:var n=3365==f.apply_id;_forIn(_idsAss(f.target_ids),function(a,b){var d=ELMM[b];if(d)switch(d.dialog_id){case 5:case 8:_attr_cmp(b).attr("disabled",n)}});break;case 214:h=_num(f.target_ids);if(!h)break;h="&p="+h;f.apply_id&&(h+="&id="+d);$(a).addClass("_busy");location.href=URL+h;return!1;case 215:h=_num(f.target_ids);if(!h)break;h={dialog_id:h,block_id:c,
busy_obj:$(a)};f.apply_id&&(h.get_id=d);f.effect_id&&(h.edit_id=d);f.revers&&(h.del_id=d);_dialogLoad(h);break;case 216:h=_num(f.target_ids);if(!h)break;if(29==ELMM[h].dialog_id)return _attr_cmp(h)._select("focus");_attr_cmp(h).focus();break;case 217:h=_num(f.target_ids);if(!h)break;location.href=URL+"&p=9&doc_id="+h+(d?"&id="+d:"");break;case 219:var m="ACT_"+f.id,h="dbg"+d,t;window[m]||(window[m]={});$("#"+h).length||(t=$(a).css("background-color"),$(a).attr("id",h).attr("data-bg",t),window[m][d]=
!0);$(a).attr("data-bg",$(a).css("background-color"));h=_ids(f.target_ids);if(!h)break;h={op:"block_upd",src_id:c,action_id:f.id,ids:h,unit_id:d,busy_obj:a};_post(h,function(b){_forIn(b.blk,function(a,b){_attr_bl(b).closest(".bl-div").after(a).remove()});_forIn(window[m],function(a,b){d!=b&&(t=$("#dbg"+b).attr("data-bg"),$("#dbg"+b).css("background-color",t))});b.bg&&$(a).css("background-color",b.bg)})}})}},_tdCss=function(){var a=$(this),c={id:a.attr("id").split("_")[1],use:a.attr("data-use")||"font color eye link place",
font:"",color:"",pos:""};if(c.id){_forIn(a.attr("class").split(" "),function(a){if("b"==a||"i"==a||"u"==a)c.font+=" "+a;if("center"==a||"r"==a)c.pos=a;ELEM_COLOR[a]&&(c.color=a)});var d={};_forIn(c.use.split(" "),function(a){d[a]=1});var b='<table class="bs5"><tr>';d.font&&(b+='<td class="pt3">'+_elemUnitFont(c));d.color&&(b+='<td class="pt3">'+_elemUnitColor(c));d.eye&&(b+='<td class="pt3 pl10"><div class="icon icon-eye pl'+_tooltip("Условия отображения",-67)+"</div>");d.link&&(b+='<td class="pl3"><div class="icon icon-link pl'+
_tooltip("Настроить ссылку",-57)+"</div>");d.place&&(b+='<td class="pt3 pl10" id="elem-pos">'+_elemUnitPlaceMiddle(c,!0));a._hint({msg:b+"</table>",side:"right",show:1,delayShow:700,delayHide:300,func:function(a){a.find(".icon-link").click(function(){_dialogLoad({dialog_id:220,element_id:c.id,busy_obj:$(this),busy_cls:"spin"})});a.find(".icon-eye").click(function(){_dialogLoad({dialog_id:240,element_id:c.id,busy_obj:$(this),busy_cls:"spin"})})}})}},_tdCssFontGet=function(a){var c=["b","i","u"],d=
[],b;for(b in c)a.hasClass(c[b])&&d.push(c[b]);return d.join(" ")},_tdCssColorGet=function(a){for(var c in ELEM_COLOR)if(a.hasClass(c))return c;return""},PHP12_elem_choose=function(a,c,d){var b=d.dlg.D;b(".el-group-head").click(function(){var a=$(this),d=a.attr("val");b(".el-group-head").removeClass("sel");a.addClass("sel");b("#elem-group .cnt")._dn(0);b("#cnt_"+d)._dn(1)});b(".elem-unit").click(function(a){$(a.target).hasClass("dialog-setup")||(a=$(this),_dialogLoad({dialog_id:a.attr("val"),block_id:d.send.block_id,
dss:d.send.dss,busy_obj:a,busy_cls:"_busy",func_save:function(a){d.dlg.close();return d.send.func_save?d.send.func_save(a):!0}}))});SA&&_forEq(b("#elem-group .cnt"),function(b){b._sort({elem_id:a.id})})},PHP12_spfl=function(a,c){function d(a){a=$.extend({elem_id:0,elem_title:"",cond_id:0,txt:"",elem_issp:0,spisok:[],unit_id:""},a);var d=a.elem_issp&&(3==a.cond_id||4==a.cond_id);l.append('<dd class="over5"><table class="bs5 w100p"><tr><td class="w50 r color-sal">Если:<td><input type="text" readonly class="title w175 curP color-pay" placeholder="выберите значение..." value="'+
a.elem_title+'" val="'+a.elem_id+'" /><td class="td-cond'+_dn(a.elem_id)+'"><input type="hidden" class="cond-id" value="'+a.cond_id+'" /><td class="w100p"><input type="text" class="cond-val w100p'+_dn(!d&&2<a.cond_id)+'"'+(0>a.unit_id?" readonly":"")+' value="'+a.txt+'" /><div class="div-cond-sel'+_dn(d)+'"><input type="hidden" class="cond-sel" value="'+a.unit_id+'" /></div><td class="td-drop'+_dn(!d&&2<a.cond_id)+'"><input type="hidden" class="cond-drop" /><td class="pl15"><div class="icon icon-del pl'+
_tooltip("Удалить условие",-52)+"</div></table></dd>");var c=l.find("dd:last"),f=c.find(".title"),m=c.find(".cond-id");f.click(function(){_dialogLoad({dialog_id:11,dss:b,dop:{mysave:1,sel:a.elem_id,nest:0,sev:0},busy_obj:$(this),busy_cls:"hold",func_save:function(b){c.find(".td-cond")._dn(1);m._select(2);a.elem_id=b.v;f.attr("val",a.elem_id);f.val(b.title);c.find(".cond-val")._dn().val("");a.elem_issp=b.issp;c.find(".div-cond-sel")._dn();c.find(".cond-sel")._select("spisok",b.spisok)._select(0)}})});
m._select({spisok:[{id:1,title:"отсутствует"},{id:2,title:"присутствует"},{id:3,title:"равно"},{id:4,title:"не равно"},{id:5,title:"больше"},{id:6,title:"больше или равно"},{id:7,title:"меньше"},{id:8,title:"меньше или равно"},{id:9,title:"содержит"},{id:10,title:"не содержит"}],func:function(b){var d=a.elem_issp&&(3==b||4==b);c.find(".cond-val")._dn(!d&&2<b).val("").attr("readonly",!1).focus();c.find(".cond-sel")._select(0);c.find(".div-cond-sel")._dn(d);c.find(".td-drop")._dn(!d&&2<b)}});c.find(".cond-sel")._select({width:0,
title0:"не выбрано",spisok:a.spisok});c.find(".cond-drop")._dropdown({width:30,title0:'<div class="icon icon-set-dot"></div>',title0_hide:1,nosel:1,spisok:g,func:function(a,b){c.find(".cond-sel").val(a);c.find(".cond-val").val(b.ass[a]).attr("readonly",!0)}});c.find(".icon-del").click(function(){$(this).closest("DD").remove()})}var b=c.dss;if(b){var f=_attr_el(a.id),l=f.append('<dl></dl><div class="fs15 color-555 pad10 center over5 curP">Добавить условие</div>').find("dl"),f=f.find("div:last"),g=
c.drop;f.click(d);c=c.vvv;c.length?_forIn(c,d):d()}},PHP12_spfl_get=function(a){var c=[];_forEq(_attr_el(a.id).find("dd"),function(a){c.push({elem_id:_ids(a.find(".title").attr("val")),cond_id:_num(a.find(".cond-id").val()),txt:a.find(".cond-val").val(),unit_id:_num(a.find(".cond-sel").val(),1)})});return c},PHP12_page_list=function(a){_attr_el(a.id).find("ol.page-sort").nestedSortable({forcePlaceholderSize:!0,placeholder:"page-sort-hold",listType:"ol",items:"li",handle:".icon-move",isTree:1,maxLevels:3,
tabSize:20,revert:200,start:function(a,d){$(d.placeholder).prev().hasClass("mb30")&&$(d.placeholder).addClass("mb30");$(d.placeholder).prev().hasClass("mb1")&&$(d.placeholder).addClass("mb1")},update:function(c,d){var b={op:"page_sort",arr:$(this).nestedSortable("toArray"),busy_obj:_attr_el(a.id),busy_cls:"spisok-busy"};_post(b,function(){var a=$(d.item),b=a.parent().hasClass("page-sort");a.removeClass(b?"mb1":"mb30");a.addClass(b?"mb30":"mb1");a.find(".pg-name:first")[(b?"add":"remove")+"Class"]("b fs14")})},
errorClass:"bg-fcc"})},PHP12_elem_rule7_get=function(a){var c=[];_forEq(_attr_el(a.id).find("input"),function(a){var b=_num(a.attr("id").split("rule7-el")[1]);a=_num(a.val());b&&a&&c.push(b)});_attr_cmp(a.id).val(c.join())},PHP12_v_choose=function(a,c,d){var b=d.dlg.D,f=b(ATTR_EL(a.id)).find(".elm-choose"),l=0;c.first&&(b(ATTR_EL(a.id)).find("#choose-menu")._menu({spisok:[{id:1,title:"Глобальные значения"},{id:2,title:"Диалог"},{id:3,title:"Стандартные значения"}]}),V11_CMP=b(ATTR_CMP(a.id)),V11_DLG=
[],V11_V=c.sev?_idsAss(c.sel):[],V11_COUNT=0,c.sel&&V11_CMP.val(c.sel),c.first=0);f.on("click dblclick",function(a){var b=$(this),h=_num(b.attr("val"),!0);if(c.sev){var p=!b.hasClass("sel");b[(p?"add":"remove")+"Class"]("sel");p?V11_V[h]=1:delete V11_V[h];var b=[],n;for(n in V11_V)b.push(n);V11_CMP.val(b.join())}else f.removeClass("sel"),b.addClass("sel"),V11_V.length=V11_COUNT,V11_V[V11_COUNT]=h,V11_DLG.length=V11_COUNT,V11_DLG[V11_COUNT]=d.dlg,V11_CMP.val(V11_V.join());switch(0>h?h:c.sev||!ELMM[h].issp?
!1:c.nest?!0:"dblclick"==a.type?!0:!1){default:-21==h&&(l=1064);break;case !0:l=ELMM[h].num_1;break;case !1:return}V11_COUNT++;_dialogLoad({dialog_id:11,block_id:d.srce.block_id,dss:l,dop:c,func_open:PHP12_v_choose_submit})})},PHP12_v_choose_submit=function(a,c){c.submit(function(){var a=c.content.find(".elm-choose.sel");a.length?(a=a.attr("val"),ELMM[a].issp&&c.err("Не выбрано конечное значение "+a),_forIn(V11_DLG,function(a,d){_num(d)&&a.close()}),V11_DLG[0].go()):c.err("Значение не выбрано")});
c.closeFunc(function(){V11_COUNT--})},PHP12_v_choose_get=function(a,c){return c.vvv[a.id]},PHP12_button_color=function(a){var c=_attr_el(a.id).find("div");c.click(function(){var d=$(this),b=_num(d.attr("val"));c.removeClass("sel");d.addClass("sel");_attr_cmp(a.id).val(b)})},PHP12_page_menu_type=function(a){var c=_attr_el(a.id).find("div");c.click(function(){var d=$(this),b=_num(d.attr("val"));c.removeClass("sel");d.addClass("sel");_attr_cmp(a.id).val(b)})},PHP12_block_choose=function(a,c,d){c=d.dlg.D;
var b=c(ATTR_EL(a.id)),f=b.find(".block-choose-level-change");f.click(function(){var c=$(this),g={op:"block_choose_level_change",block_id:d.srce.block_id,level:_num(c.html()),busy_obj:b.find(".level-hold")};c.hasClass("orange")||_post(g,function(e){b.find("#block-choose-div").html(e.html);f.removeClass("orange").addClass("cancel");c.removeClass("cancel").addClass("orange");PHP12_block_choose_bc(a,d)})});PHP12_block_choose_bc(a,d)},PHP12_block_choose_bc=function(a,c){var d=c.dlg.D,d=d(ATTR_EL(a.id)).find(".blk-choose");
d.click(function(){var a=$(this);a.attr("val");var d=a.hasClass("sel");a[(d?"remove":"add")+"Class"]("sel")});return d},PHP12_block_choose_get=function(a,c){var d=[];_forEq(PHP12_block_choose_bc(a,c),function(a){a.hasClass("sel")&&d.push(a.attr("val"))});return d.join()},PHP12_insert_unit_change=function(a,c,d){var b=_attr_el(a.id).append("<dl></dl>").find("dl");_forN(c,function(a){b.append('<dd class="mt5"><table><tr><td><input type="text" class="inp-dst w200 color-ref curD" readonly val="'+a.dst_id+
'" value="'+a.dst_title+'" /><td class="w25 center fs17 grey"> &laquo; <td><input type="text" class="inp-src w200 color-pay curP over1" readonly val="'+a.src_id+'" value="'+a.src_title+'" placeholder="не изменять" /><td><div class="icon icon-del pl'+_dn(a.src_id)+_tooltip("Отменить выбор",-52)+"</div></table></dd>");a=b.find("dd:last");var c=a.find(".inp-src"),g=a.find(".icon-del");c.click(function(){_dialogLoad({dialog_id:11,dss:d.unit.id,dop:{mysave:1,sel:_num($(this).attr("val")),nest:0},busy_obj:$(this),
busy_cls:"hold",func_save:function(a){c.attr("val",a.v);c.val(a.title);g._dn(1)}})});g.click(function(){c.attr("val",0);c.val("");g._dn()})})},PHP12_insert_unit_change_get=function(a){var c=[];_forEq(_attr_el(a.id).find("dd"),function(a){var b=_num(a.find(".inp-src").attr("val"));b&&c.push(_num(a.find(".inp-dst").attr("val"))+":"+b)});_attr_cmp(a.id).val(c.join())},PHP12_menu_block_setup=function(a,c,d){function b(a){a=$.extend({id:0,num:g,title:"Имя пункта "+g++,blk:"",def:0},a);l.append('<dd class="over5" val="'+
a.id+'" data-num="'+a.num+'"><table class="bs5 w100p"><tr><td class="w35 pl5"><div class="icon icon-move-y pl curM"></div><td class="w15"><input type="hidden" class="def" value="'+a.def+'" /><td><input type="text" class="pk-title w100p" placeholder="имя не указано" value="'+a.title+'" /><td class="w125"><input type="text" class="pk-block w100p curP color-ref over1" readonly placeholder="выбрать блоки" value="'+e(a.blk)+'" val="'+a.blk+'" /><td class="w35 r"><div class="icon icon-del pl'+_tooltip("Удалить пункт",
-44)+"</div></table></dd>");var b=l.find("dd:last"),c=b.find(".pk-title"),m=b.find(".pk-block");c.focus();m.click(function(){var b=[];_forEq(f.find("dd"),function(d){_num(d.attr("data-num"))!=a.num&&_forN(d.find(".pk-block").attr("val").split(","),function(a){a&&b.push(a)})});_dialogLoad({dialog_id:19,block_id:d.srce.block_id,dop:{level_deny:0,blk_deny:b.join(),sel:m.attr("val")},busy_obj:m,busy_cls:"hold",func_save:function(a){m.attr("val",a.ids).val(e(a.ids))._flash()}})});b.find(".def")._check({tooltip:"По умолчанию",
func:function(a,b){a&&_forEq(l.find(".def"),function(a){a.attr("id")!=b.attr("id")&&a._check(0)})}});l.sortable({axis:"y",handle:".icon-move-y"});b.find(".icon-del").click(function(){$(this).closest("DD").remove()})}var f=_attr_el(a.id),l=f.append('<dl></dl><div class="fs15 color-555 pad10 center over5 curP">Новый пункт меню</div>').find("dl"),g=1,e=function(a){if(!a)return"";var b=a.split(",").length;return 1!=b||_num(a)?b+" блок"+_end(b,["","а","ов"]):""};f.find("div:last").click(b);c.length?_forIn(c,
b):b()},PHP12_menu_block_setup_get=function(a){var c=[];_forEq(_attr_el(a.id).find("dd"),function(a){c.push({id:a.attr("val"),title:a.find(".pk-title").val(),blk:a.find(".pk-block").attr("val"),def:a.find(".def").val()})});return c},PHP12_td_setup=function(a,c,d){function b(a){a=$.extend({id:0,dialog_id:50,title:"",width:150,font:"",color:"",txt_7:"",txt_8:"",eye:1},a.id?a:{});a.pos=a.txt_8;g.append('<dd class="over3" val="'+a.id+'"><table class="bs5 w100p"><tr><td class="w25 center top pt5"><div class="icon icon-move-y pl curM"></div><td class="w25 r topi"><b class="bnum fs15 color-555">'+
p+'</b>:<td><div style="width:'+a.width+'px"><div class="div-th-name'+_dn(_num(d.unit.num_5))+'"><input type="text" class="th-name w100p bg-gr2 center fs14 blue mb1" placeholder="имя колонки" value="'+a.txt_7+'" /></div><input type="text" id="'+ATTR_EL(a.id,!0)+'" class="inp w100p curP '+a.font+" "+a.color+" "+a.txt_8+'" readonly placeholder="значение не выбрано" value="'+a.title+'" /></div><td class="w25 r top pt5"><div class="icon icon-del pl'+_tooltip("Удалить колонку",-52)+"</div></table></dd>");
var b=g.find("dd:last"),c=b.find(".inp");f(b);c.click(function(){_dialogLoad({dialog_id:a.dialog_id,block_id:d.srce.block_id,edit_id:a.id,busy_obj:c,busy_cls:"hold",func_save:function(d){b.attr("val",d.unit.id);a.id=d.unit.id;a.dialog_id=d.unit.dialog_id;c.val(d.unit.title);c.attr("id",ATTR_EL(a.id,!0));f(b);l()}})});c.mouseenter(function(){c.hasClass("_busy")||c.parent().hasClass("ui-resizable")&&(c.parent().hasClass("ui-resizable-resizing")||c._hint({msg:'<table class="bs5"><tr><td class="pt3">'+
_elemUnitFont(a)+'<td class="pt3">'+_elemUnitColor(a)+'<td class="pt3 pl10"><div class="icon icon-eye pl'+_tooltip("Условия отображения",-67)+'</div><td class="pl3"><div class="icon icon-link pl'+_tooltip("Настроить ссылку",-57)+'</div><td class="pt3 pl10" id="elem-pos">'+_elemUnitPlaceMiddle(a,!0)+"</table>",side:"right",show:1,delayShow:700,delayHide:300,func:function(b){b.find(".icon-link").click(function(){_dialogLoad({dialog_id:220,element_id:a.id,busy_obj:$(this),busy_cls:"spin"})});b.find(".icon-eye").click(function(){_dialogLoad({dialog_id:240,
element_id:a.id,busy_obj:$(this),busy_cls:"spin"})})}}))});g.sortable({handle:".icon-move-y",update:l});g.find(".icon-del:last").click(function(){$(this).closest("DD").remove();l()});p++}function f(a){_num(a.attr("val"))&&(a=a.find(".div-th-name").parent(),a.hasClass("ui-resizable")||a.resizable({minWidth:30,maxWidth:500,grid:10,handles:"e",stop:l}))}function l(){var a="",b=600/h,d=0,c=[],f=0;_forEq(g.find("DD"),function(a){if(_num(a.attr("val"))){var e=_num(a.find(".bnum").html());a=a.find(".div-th-name").parent().width();
c.push({n:e,w:Math.round(a*b)-1});d+=a}});_forN(c,function(e,g){var l="ffc",p=" line-r";d>h&&(l="fcc",b=h/d,e.w=Math.round(e.w*b));d>=h&&(f+=e.w+1,g==c.length-1&&(p="",e.w=600-f+e.w+1));a+='<div class="h25 dib center bg-'+l+p+'" style="width:'+e.w+'px"><div class="fs15 b color-555 pt5">'+e.n+"</div></div>"});e.html(a)}if(d.unit.id){var g=_attr_el(a.id).append('<dl class="mt10"></dl><div class="fs15 color-555 pad10 center over1 curP">Добавить колонку</div>').find("dl"),e=_attr_el(a.id).find(".calc-div"),
h=_num(e.html()),p=1;_attr_el(a.id).find("div:last").click(b);$("#cmp_531")._check({func:function(a){d.unit.num_5=a;g.find(".div-th-name")["slide"+(a?"Down":"Up")]()}});_forIn(c,b);l()}},PHP12_td_setup_get=function(a){var c=[];_forEq(_attr_el(a.id).find("dd"),function(a){var b={},f=a.find(".inp");b.id=_num(a.attr("val"));if(b.id){b.width=_num(a.find(".div-th-name").parent().width());b.txt_7=a.find(".th-name").val();b.font=_tdCssFontGet(f);b.color=_tdCssColorGet(f);a=["center","r"];b.txt_8="";for(k in a)f.hasClass(a[k])&&
(b.txt_8=a[k]);c.push(b)}});return c},PHP12_elem34=function(a,c,d){function b(a){a=$.extend({title:"",dialog_id:"",sum_id:0,sum_title:"",cond:"",c:""},a);f.append('<dd class="over5"><table class="bs5 w100p"><tr><td class="w25 center top pt5"><div class="icon icon-move-y pl curM"></div><td><input type="text" class="title w100p" placeholder="Заголовок не указан" value="'+a.title+'"><td><input type="hidden" class="dlg34" value="'+a.dialog_id+'" /><td><input type="hidden" class="sum34" value="'+a.sum_id+
'" /><div class="_selem dib prel bg-fff over3"><div class="icon icon-star pabs"></div><div class="icon icon-del pl pabs'+_dn(a.sum_id)+'"></div><input type="text" readonly class="w175 curP w100p color-pay" placeholder="сумма не выбрана" value="'+a.sum_title+'" /></div><td><input type="hidden" class="cond" /><div class="_spfl dib w125 prel"><div class="icon icon-filter pabs"></div><div class="icon icon-del pl pabs'+_dn(a.cond)+'"></div><input type="text" readonly class="filter color-del b pl25 curP w100p over3" placeholder="условий нет" value="'+
a.c+'" /></div><td class="w25 r top pt5"><div class="icon icon-del pl'+_tooltip("Удалить список",-48)+"</div></table></dd>");f.sortable({handle:".icon-move-y"});var b=f.find("dd:last");b.find(".dlg34")._select({width:260,title0:"список не выбран",spisok:c.sp});b.find(".cond").val(a.cond);b.find("._selem").click(function(){var a=$(this),d=a.prev(),c=a.find("input"),f=a.find(".icon-del"),a=_num(b.find(".dlg34").val());if(!a)return!1;_dialogLoad({dialog_id:11,dss:a,dop:{mysave:1,sel:d.val()},busy_obj:d,
busy_cls:"hold",func_save:function(a){d.val(a.v);c.val(a.title);f._dn(1)}})});b.find("._spfl").click(function(){var a=$(this),d=a.find("input"),c=_num(b.find(".dlg34").val());if(!c)return!1;_dialogLoad({dialog_id:41,dss:c,dop:a.prev().val(),busy_obj:d,busy_cls:"hold",func_save:function(b){a.prev().val(b.v);d.val(b.title);a.find(".icon-del")._dn(1)}})});b.find(".icon-del").click(function(){$(this).closest("DD").remove()});a.id||b.find(".title").focus()}a=_attr_el(a.id);var f=a.append('<dl></dl><div class="fs15 color-555 pad10 center over5 curP">Добавить список</div>').find("dl");
a.find("div:last").click(b);d.unit.id?_forIn(c.val,b):b()},PHP12_elem34_get=function(a){var c=[];_forEq(_attr_el(a.id).find("dd"),function(a){var b=_num(a.find(".dlg34").val());b&&c.push({title:a.find(".title").val(),dialog_id:b,sum_id:_num(a.find(".sum34").val()),cond:a.find(".cond").val()})});return c},PHP12_elem88=function(a,c,d){d.unit.id&&(window.EL88=_attr_el(a.id),window.COL88=c.col,PHP12_elem88_sp(a,c),PHP12_elem88_td(a,c))},PHP12_elem88_sp=function(a,c){function d(a){function d(a){var c;
_forEq(b.find(".icon-del-red"),function(b,d){a==b.attr("val")&&(c=d)});return c}a=$.extend({dialog_id:0,cond:"",c:""},a);b.append('<dd><table class="bs5 spv-tab"><tr><td><input type="hidden" class="cond" /><div class="_spfl dib w125 prel"><div class="icon icon-filter pabs"></div><div class="icon icon-del pl pabs'+_dn(a.cond)+'"></div><input type="text" readonly class="color-del b pl25 curP w100p over3" placeholder="условий нет" value="'+a.c+'" /></div><td><input type="hidden" class="spv" value="'+
a.dialog_id+'" /><td class="w25"><div class="icon icon-set-b pl'+_tooltip("Настроить колонки",-58)+'</div><td class="w25"><div val="'+f++ +'" class="icon icon-del-red pl'+_tooltip("Удалить список",-48)+"</div></table></dd>");var e=b.find("dd:last");e.find(".cond").val(a.cond);e.find("._spfl").click(function(){var a=$(this),b=a.find("input");_dialogLoad({dialog_id:41,dss:e.find(".spv").val(),dop:a.prev().val(),busy_obj:b,busy_cls:"hold",func_save:function(d){a.prev().val(d.v);b.val(d.title);a.find(".icon-del")._dn(1)}})});
e.find(".spv")._select({width:390,title0:"список не выбран",spisok:c.sp});b.find(".icon-set-b:last").click(function(){var a=$(this),b=_num(e.find(".spv").val()),f=d(e.find(".icon-del-red").attr("val"));b&&void 0!==f&&_dialogLoad({dialog_id:89,dss:b,block_id:c.block_id,edit_id:c.element_id,dop:f,busy_obj:a,busy_cls:"spin"})});b.find(".icon-del-red:last").click(function(){var a=$(this),b=d(a.attr("val"));void 0!==b&&(a.closest("DD").remove(),PHP12_elem88_upd("spdel",b))})}var b=_attr_el(a.id).find("#sp88"),
f=0;b.next().click(function(){d();PHP12_elem88_upd("spadd")});c.spv.length?_forN(c.spv,d):(d(),PHP12_elem88_upd("spadd"))},PHP12_elem88_td=function(a,c){function d(a){a=$.extend({width:150,title:""},a);l.append('<dd class="over3"><table class="bs5 w100p"><tr><td class="w25 center top pt5"><div class="icon icon-move-y pl curM"></div><td class="w25 r topi"><b class="bnum fs15 color-555">'+h+'</b>:<td><div style="width:'+a.width+'px"><input type="text" class="th-name w100p bg-gr2 fs14 blue" placeholder="имя колонки" value="'+
a.title+'" /></div><td class="w25 r top pt5"><div class="icon icon-del pl'+_tooltip("Удалить колонку",-51)+"</div></table></dd>");a=l.find("dd:last");b(a);l.sortable({handle:".icon-move-y",update:function(){PHP12_elem88_upd("tdsort");f()}});l.find(".icon-del:last").click(function(){var a=$(this).closest("DD"),b=_num(a.find(".bnum").html())-1;a.remove();f();PHP12_elem88_upd("tddel",b)});a.find(".th-name").focus();h++;f()}function b(a){a=a.find(".th-name").parent();a.hasClass("ui-resizable")||a.resizable({minWidth:30,
maxWidth:500,grid:10,handles:"e",stop:f})}function f(){var a="",b=600/e,d=0,c=[],f=0;_forEq(l.find("DD"),function(a){var e=_num(a.find(".bnum").html());a=a.find(".th-name").parent().width();c.push({n:e,w:Math.round(a*b)-1});d+=a});_forN(c,function(g,h){var l="ffc",B=" line-r";d>e&&(l="fcc",b=e/d,g.w=Math.round(g.w*b));d>=e&&(f+=g.w+1,h==c.length-1&&(B="",g.w=600-f+g.w+1));a+='<div class="h25 dib center bg-'+l+B+'" style="width:'+g.w+'px"><div class="fs15 b color-555 pt5">'+g.n+"</div></div>"});g.html(a)}
var l=_attr_el(a.id).find("#col88"),g=_attr_el(a.id).find(".calc-div"),e=_num(g.html()),h=1;l.next().click(function(){d();PHP12_elem88_upd("tdadd")});c.col.length?_forIn(c.col,d):(d(),PHP12_elem88_upd("tdadd"))},PHP12_elem88_upd=function(a,c){if(window.EL88){switch(a){case "spadd":_forN(COL88,function(a,b){COL88[b].elm.push(0)});break;case "spdel":_forN(COL88,function(a,b){COL88[b].elm.splice(c,1)});break;case "tdadd":var d={width:150,title:"",elm:[]};_forN(EL88.find(".spv"),function(){d.elm.push(0)});
COL88.push(d);break;case "tddel":COL88.splice(c,1);break;case "tdsort":var b=[];_forEq(EL88.find(".bnum"),function(a,d){var c=_num(a.html())-1;b.push(COL88[c]);a.html(d+1)});COL88=b}_forEq(EL88.find(".th-name"),function(a){var b=_num(a.closest("DD").find(".bnum").html())-1;COL88[b].width=a.parent().width();COL88[b].title=a.val()})}},PHP12_elem88_get=function(a){var c=[];PHP12_elem88_upd();_forEq(_attr_el(a.id).find(".spv-tab"),function(a){var b=_num(a.find(".spv").val());c.push({dialog_id:b,cond:a.find(".cond").val()})});
return{spv:c,col:window.COL88?COL88:{}}},PHP12_elem89=function(a,c){var d="";_forIn(COL88,function(a,f){var l=_num(a.elm[c.i]),g=$.extend({id:0,dialog_id:50,title:"",font:""},c.elm[l]);d+='<div class="fs14 grey">'+a.title+'</div><div class="prel" style="width:'+a.width+'px"><div class="icon icon-del-red pl pabs r3 top5'+_dn(g.id)+'"></div><input type="text" id="'+ATTR_EL(l,1)+'" class="w100p curP over1 mb10 pr20 '+g.font+" "+g.color+" "+g.txt_8+'" placeholder="элемент не указан" readonly data-n="'+
f+'" data-did="'+g.dialog_id+'" val="'+g.id+'" value="'+g.title+'"></div>'});$("#col89").html(d).find("input").click(function(){var a=$(this);_dialogLoad({dialog_id:_num(a.attr("data-did")),dss:c.dss,block_id:c.block_id,edit_id:_num(a.attr("val")),dop:{rule_id:5,mysave:1},busy_obj:a,busy_cls:"hold",func_save:function(d){a.val(d.unit.title);a.attr("data-did",d.unit.dialog_id);a.attr("val",d.unit.id);a.attr("id",ATTR_EL(d.unit.id,1));a.prev()._dn(1);COL88[_num(a.attr("data-n"))].elm[c.i]=d.unit.id;
c.elm[d.unit.id]=d.unit}})}).mouseenter(_tdCss).end().find(".icon").click(function(){var a=$(this)._dn().next();a.val("").attr("data-did",50).attr("val",0);COL88[_num(a.attr("data-n"))].elm[c.i]=0})},PHP12_elem89_get=function(a){var c=[];_forEq(_attr_el(a.id).find("input"),function(a){var b={};b.id=_num(a.attr("val"));if(b.id){b.font=_tdCssFontGet(a);arr=["center","r"];b.txt_8="";for(k in arr)a.hasClass(arr[k])&&(b.txt_8=arr[k]);b.color="";for(k in ELEM_COLOR)a.hasClass(k)&&(b.color=k);c.push(b)}});
return c},_elem88next=function(a,c,d){_post({op:"elem88next",elem_id:c,next:d,busy_obj:a},function(b){a.closest("._stab").append(b.spisok);a.remove()})},PHP12_radio_setup=function(a,c,d){function b(b){b=$.extend({id:0,title:"имя значения "+g,content:"",def:0,use:0},b);l.append('<dd class="over1" val="'+b.id+'"><table class="bs5 w100p"><tr><td class="w25 center top pt5"><div class="icon icon-move-y pl curM"></div><td class="w90 grey r topi">Значение '+g+':<td><input type="text" class="title w100p b" value="'+
b.title+'" /><textarea class="w100p min mtm1'+_dn(a.num_1)+'" placeholder="описание значения">'+b.content+'</textarea><td class="w15 topi"><input type="hidden" class="def" id="el-def-'+g+'" value="'+b.def+'" /><td class="w50 r top pt5">'+(b.use?'<div class="dib fs11 color-ccc mr3 curD'+_tooltip("Использование",-53)+b.use+"</div>":'<div class="icon icon-del pl'+_tooltip("Удалить значение",-55)+"</div>")+"</table></dd>");l.sortable({axis:"y",handle:".icon-move-y"});var d=l.find("dd:last");d.find("textarea")._autosize();
d.find(".def")._check({tooltip:"По умолчанию",func:function(a,b){a&&_forEq(l.find(".def"),function(a){a.attr("id")!=b.attr("id")&&a._check(0)})}});d.find(".icon-del").click(function(){$(this).closest("DD").remove()});b.id||d.find(".title").select();g++}var f=_attr_el(a.id),l=f.append('<dl></dl><div class="fs15 color-555 pad10 center over1 curP">Добавить значение</div>').find("dl"),g=1;f.find("div:last").click(b);d.unit.id?_forIn(c,b):(b(),b())},PHP12_radio_setup_get=function(a){var c=[];_forEq(_attr_el(a.id).find("dd"),
function(a){c.push({id:_num(a.attr("val")),title:a.find(".title").val(),content:a.find("textarea").val(),def:_num(a.find(".def").val())})});return c},PHP12_filter_radio_setup=function(a,c,d){function b(a){a=$.extend({id:0,txt_1:"Значение "+g++,def:0,c:0,txt_2:"",num_1:1},a);f.append('<dd class="over3" val="'+a.id+'"><table class="bs5 w100p"><tr><td class="w25 center top pt5"><div class="icon icon-move-y pl curM"></div><td><input type="text" class="title w200 mr10" placeholder="имя значения" value="'+
a.txt_1+'" /><input type="hidden" class="def" value="'+a.def+'" /><span class="span-cs grey">'+e(a.c)+'</span><input type="hidden" class="txt_2" value="'+a.txt_2+'" /><td class="w100"><div class="icon icon-eye'+_dn(!a.num_1,"over3-show pl")+_tooltip("Отображать<br>количество",-38,"",1)+'</div><td class="w35 r"><div class="icon icon-del-red pl'+_tooltip("Удалить значение",-54)+"</div></table></dd>");f.sortable({handle:".icon-move-y"});var b=f.find("dd:last");b.find(".def")._check({tooltip:"По умолчанию",
func:function(a,b){a&&_forEq(f.find(".def"),function(a){a.attr("id")!=b.attr("id")&&a._check(0)})}});b.find(".span-cs").click(function(){_dialogLoad({dialog_id:41,dss:l.val(),element_id:2585,dop:a.txt_2,busy_obj:$(this).find(".cond-setup"),busy_cls:a.c?"_busy":"spin",func_save:function(d){a.txt_2=d.v;b.find(".txt_2").val(d.v);a.c=d.c;b.find(".span-cs").html(e(d.c))}})});b.find(".icon-eye").click(function(){var a=$(this),b=!a.hasClass("over3-show");a._dn(!b,"over3-show pl")});b.find(".icon-del-red").click(function(){$(this).closest("DD").remove()})}
if(d.unit.id){a=_attr_el(a.id);var f=a.append('<dl></dl><div class="fs15 color-555 pad10 center over1 curP">Добавить значение</div>').find("dl");a=a.find("div:last");var l=_attr_cmp(2585),g=1,e=function(a){return a?'<span class="cond-setup ml20 curP'+_tooltip("Настроить",-10)+a+" услови"+_end(a,["е","я","й"])+"</span>":'<div class="icon icon-add cond-setup pl ml15'+_tooltip("Добавить условия",-57)+"</div>"};a.click(b);c.length?_forIn(c,b):b()}},PHP12_filter_radio_setup_get=function(a){var c=[];_forEq(_attr_el(a.id).find("dd"),
function(a){c.push({id:_num(a.attr("val")),txt_1:a.find(".title").val(),txt_2:a.find(".txt_2").val(),def:a.find(".def").val(),num_1:a.find(".icon-eye").hasClass("pl")?0:1})});return c},PHP12_count_value=function(a,c,d){function b(a){a=$.extend({id:l++,title:"",def:0},a);f.append('<dd class="over1"><table class="bs5 w100p"><tr><td class="w25 center top pt5"><div class="icon icon-move-y pl curM"></div><td class="w35 center"><input type="hidden" class="def" value="'+a.def+'" /><td class="w50"><input type="text" class="vid w50 r" value="'+
a.id+'" /><td><input type="text" class="title w100p" placeholder="имя значения не обязательно" value="'+a.title+'" /><td class="w50 r top pt5"><div class="icon icon-del pl'+_tooltip("Удалить значение",-55)+"</div></table></dd>");f.sortable({handle:".icon-move-y"});a=f.find("dd:last");a.find(".def")._check({tooltip:"Начальное значение",func:function(a,b){a&&_forEq(f.find(".def"),function(a){a.attr("id")!=b.attr("id")&&a._check(0)})}});a.find(".icon-del").click(function(){$(this).closest("DD").remove()});
a.find(".vid").select()}a=_attr_el(a.id);var f=a.append('<dl></dl><div class="fs15 color-555 pad10 center over1 curP">Добавить значение</div>').find("dl"),l=1;a.find("div:last").click(b);d.unit.id&&_forIn(c,b)},PHP12_count_value_get=function(a){var c=[];_forEq(_attr_el(a.id).find("dd"),function(a){c.push({id:_num(a.find(".vid").val(),1),title:a.find(".title").val(),def:_num(a.find(".def").val())})});return c},PHP12_elem44_setup=function(a,c,d){function b(a){a=$.extend({txt:"",font:"",color:""},a||
{});l.append('<dd class="over3" data-type="txt"><table class="bs5 w100p"><tr><td class="w25 center"><div class="icon icon-move-y pl curM"></div><td><textarea class="w100p h25 '+a.font+" "+a.color+'" style="background-color:#fff" id="'+ATTR_EL("area"+g++,!0)+'" data-use="font color">'+a.txt+'</textarea><td class="w50 r"><div class="icon icon-del-red pl'+_tooltip("Удалить",-25)+"</div></table></dd>");a=l.find("dd:last");a.find("textarea").mouseenter(_tdCss);l.sortable({handle:".icon-move-y"});a.find(".icon-del-red").click(function(){$(this).closest("DD").remove()});
a.find("textarea")._autosize().focus()}function f(a){a=$.extend({id:0,dialog_id:50,title:"",font:"",color:""},a||{});l.append('<dd class="over3" data-type="el" val="'+a.id+'"><table class="bs5 w100p"><tr><td class="w25 center"><div class="icon icon-move-y pl curM"></div><td class="prel"><input type="text" id="'+ATTR_EL(a.id,!0)+'" class="inp w100p curP bg-gr2 '+a.font+" "+a.color+'" readonly placeholder="элемент не выбран" value="'+a.title+'" data-use="font color link eye" /><div class="icon icon-star pabs top6 r5"></div><td class="w50 r"><div class="icon icon-del-red pl'+
_tooltip("Удалить",-25)+"</div></table></dd>");var b=l.find("dd:last"),c=b.find(".inp");c.click(function(){_dialogLoad({dialog_id:a.dialog_id,block_id:d.srce.block_id,dss:d.srce.dss,edit_id:a.id,dop:{rule_id:4,mysave:1},busy_obj:c,busy_cls:"hold",func_save:function(d){b.attr("val",d.unit.id);a.id=d.unit.id;a.dialog_id=d.unit.dialog_id;c.val(d.unit.title)}})});c.mouseenter(_tdCss);l.sortable({handle:".icon-move-y"});b.find(".icon-del-red").click(function(){$(this).closest("DD").remove();a.id=0})}if(d.unit.id){a=
_attr_el(a.id);var l=a.append('<dl></dl><table class="w100p"><tr><td><div class="fs15 color-555 pad10 center over1 curP add34-txt">Добавить текст</div><td><div class="fs15 color-555 pad10 center over1 curP add34-el">Добавить элемент</div></table>').find("dl"),g=1;a.find(".add34-txt").click(b);a.find(".add34-el").click(f);c.length?_forN(c,function(a){switch(a.type){case "txt":b(a);break;case "el":f(a)}}):(b(),f())}},PHP12_elem44_setup_get=function(a){var c=[];_forEq(_attr_el(a.id).find("dd"),function(a){switch(a.attr("data-type")){case "txt":var b=
a.find("textarea");a=b.val();if(!a)break;c.push({type:"txt",txt:a,font:_tdCssFontGet(b),color:_tdCssColorGet(b)});break;case "el":b=a.find(".inp");a=_num(a.attr("val"));if(!a)break;c.push({type:"el",id:a,font:_tdCssFontGet(b),color:_tdCssColorGet(b)})}});return c},PHP12_balans_setup=function(a,c,d){function b(a){a=$.extend({id:0,minus:0,title:""},a);f.append('<dd class="over3" val="'+a.id+'"><table class="bs5 w100p"><tr><td class="w50 pl5"><div class="icon icon-move-y pl curM"></div><td class="w25 r"><button class="vk short '+
(a.minus?"red":"green")+' w35">'+(a.minus?"—":"+")+'</button><td><input type="text" class="inp w100p curP" readonly placeholder="значение не выбрано" value="'+a.title+'" /><td class="w50 r"><div class="icon icon-del pl'+_tooltip("Удалить значение",-54)+"</div></table></dd>");var b=f.find("dd:last"),c=b.find(".inp");c.click(function(){_dialogLoad({dialog_id:11,block_id:d.srce.block_id,edit_id:a.id,dop:{nest:0,allow:"8,27,54,55"},busy_obj:c,busy_cls:"hold",func_save:function(d){b.attr("val",d.unit.id);
a.id=d.unit.id;c.val(d.unit.title)}})});f.sortable({axis:"y",handle:".icon-move-y"});b.find("button")._tooltip("Прибавление",-33).click(function(){var a=$(this),b=a.hasClass("green");a.html(b?"—":"+");a._dn(b,"green");a._dn(!b,"red");a._tooltip(b?"Вычитание":"Прибавление",b?-26:-33)});b.find(".icon-del").click(function(){$(this).closest("DD").remove();a.id=0})}if(d.unit.id){a=_attr_el(a.id);var f=a.append('<dl></dl><div class="fs15 color-555 pad10 center over1 curP">Добавить значение</div>').find("dl");
a.find("div:last").click(b);_forIn(c,b)}},PHP12_balans_setup_get=function(a){var c=[];_forEq(_attr_el(a.id).find("dd"),function(a){var b=_num(a.attr("val"));b&&c.push({id:b,minus:a.find("button").hasClass("green")?0:1})});return c},PHP12_icon18_list=function(a){var c=_attr_el(a.id).find(".icu");c.click(function(){var d=$(this),b=_num(d.attr("val"));c.removeClass("sel");d.addClass("sel");_attr_cmp(a.id).val(b)})},PHP12_action_list=function(a){_attr_el(a.id).find("DL")._sort({table:"_action"})},PHP12_template_param=
function(a,c,d){function b(a){a=$.extend({id:0,txt_10:"{00000"+g++ +"}",dialog_id:50,title:""},a||{});f.append('<dd id="dd'+a.id+'" class="over5"><table class="bs5 w100p"><tr><td class="w25 center"><div class="icon icon-move-y pl curM"></div><td><input type="text" class="w200 b txt_10" placeholder="код значения" maxlength="20" value="'+a.txt_10+'" /><td class="w100p"><input type="text" class="inp w250 curP color-pay" readonly placeholder="значение не выбрано" value="'+(a.title||a.id||"")+'" /><td class="w50 r"><div class="icon icon-del pl'+
_tooltip("Удалить параметр",-55)+"</div></table></dd>");var b=f.find("dd:last"),c=b.find(".inp");c.click(function(){_dialogLoad({dialog_id:a.dialog_id,dss:l,edit_id:a.id,dop:{nest:1,rule_id:6},busy_obj:c,busy_cls:"hold",func_save:function(d){b.attr("id","dd"+d.unit.id);a.id=d.unit.id;a.dialog_id=d.unit.dialog_id;c.val(d.unit.title||d.unit.id)}})});f.sortable({handle:".icon-move-y"});b.find(".icon-del").click(function(){$(this).closest("DD").remove();a.id=0});b.find(".code").focus()}if(d.unit.id){d=
_attr_el(a.id);var f=d.append('<dl></dl><div class="fs15 color-555 pad10 center over5 curP">Добавить параметр</div>').find("dl");a=_attr_cmp(3528);var l=_num(a.val());d=d.find("div:last");var g=1;a._select("disable");d.click(b);c.length?_forIn(c,b):b()}},PHP12_template_param_get=function(a,c){var d=[];_forEq(_attr_el(a.id).find("dd"),function(a){d.push({elem_id:_num(a.attr("id").split("dd")[1]),txt_10:a.find(".txt_10").val()})});return d},PHP12_cron_dst_prm=function(a,c,d){if(d.unit.id){var b=_attr_el(a.id).append("<dl></dl>").find("dl");
_forN(c,function(a,c){b.append('<dd class="mt5"><table><tr><td><input type="text" class="inp-dst w200 color-ref curD" readonly val="'+a.dst_id+'" value="'+a.dst_title+'" /><td class="w25 center fs17 grey"> &laquo; <td><input type="text" class="inp-src w200 color-pay curP over1" readonly val="'+a.src_id+'" value="'+a.src_title+'" placeholder="авто" /><td><div class="icon icon-del pl'+_dn(a.src_id)+_tooltip("Отменить выбор",-52)+"</div></table></dd>");var g=b.find("dd:last"),e=g.find(".inp-src"),h=
g.find(".icon-del");e.click(function(){_dialogLoad({dialog_id:11,dss:d.unit.src_spisok,dop:{mysave:1,sel:_num($(this).attr("val")),nest:0},busy_obj:$(this),busy_cls:"hold",func_save:function(a){e.attr("val",a.v);e.val(a.title);h._dn(1)}})});h.click(function(){e.attr("val",0);e.val("");h._dn()})})}},PHP12_cron_dst_prm_get=function(a){var c=[];_forEq(_attr_el(a.id).find("dd"),function(a){c.push(_num(a.find(".inp-dst").attr("val"))+":"+_num(a.find(".inp-src").attr("val")))});_attr_cmp(a.id).val(c.join())},
PHP12_history_setup=function(a,c,d){function b(a){return a?a+" услови"+_end(a,["е","я","й"]):"без условий"}function f(a){a=$.extend({id:0,dialog_id:50,title:"",txt_7:"",txt_8:"",c:0,txt_9:"",font:"",color:""},a||{});l.append('<dd class="over3" val="'+a.id+'"><table class="bs5 w100p"><tr><td class="w25 center"><div class="icon icon-move-y pl curM"></div><td class="w100 center"><a class="cs '+(a.c?"color-ref b":"pale")+_tooltip("Настроить условия<br>показа сборки",-40,!1,!0)+b(a.c)+'</a><input type="hidden" class="txt_9" value="'+
a.txt_9+'" /><td class="w250"><input type="text" class="txt_7 w100p" placeholder="текст слева" value="'+a.txt_7+'" /><td class="w250"><input type="text" readonly id="'+ATTR_EL(a.id,!0)+'" class="title w100p curP over4 '+a.font+" "+a.color+'" placeholder="значение из диалога" value="'+a.title+'" /><td class="w250"><input type="text" class="txt_8 w100p" placeholder="текст справа" value="'+a.txt_8+'" /><td class="r"><div class="icon icon-del pl'+_tooltip("Удалить сборку",-48)+"</div></table></dd>");
var c=l.find("dd:last"),f=c.find(".title");c.find(".cs").click(function(){_dialogLoad({dialog_id:41,dss:d.srce.dss,dop:c.find(".txt_9").val(),busy_obj:$(this),func_save:function(a){c.find(".txt_9").val(a.v);c.find(".cs").html(b(a.c))._dn(a.c,"pale")._dn(!a.c,"color-ref b")}})});f.click(function(){_dialogLoad({dialog_id:a.dialog_id||50,dss:d.srce.dss,edit_id:a.id,dop:{rule_id:6},busy_obj:f,busy_cls:"hold",func_save:function(b){a.id=b.unit.id;a.dialog_id=b.unit.dialog_id;c.attr("val",a.id);f.val(b.unit.title);
c.find(".txt_8").focus()}})});f.mouseenter(function(){a.dialog_id&&(f.hasClass("hold")||f._hint({msg:'<table class="bs5"><tr><td class="pt3">'+_elemUnitFont(a)+'<td class="pt3">'+_elemUnitColor(a)+'<td class="pt3">'+_elemUnitFormat(a)+'<td class="pt3"><div class="icon-wiki iw12 ml3'+_tooltip("Ссылка",-22)+"</div></table>",side:"top",ugPos:"left",objPos:20,show:1,delayShow:500,delayHide:300,func:function(b){b.find(".iw12").click(function(){var b=$(this);if(b.hasClass("on"))return b.removeClass("on"),
c.attr("data-url",0),!1;_dialogLoad({dialog_id:220,element_id:a.id,busy_obj:$(this),func_save:function(a){}})})}}))});c.find(".icon-del").click(function(){$(this).closest("DD").remove()});c.find(".txt_7").focus()}a=_attr_el(a.id);var l=a.append('<dl></dl><div class="fs15 color-555 pad10 center over1 curP">Добавить сборку</div>').find("dl");a.find("div:last").click(f);c.length?_forIn(c,f):f();l.sortable({handle:".icon-move-y"})},PHP12_history_setup_get=function(a,c){var d=[];_forEq(_attr_el(a.id).find("dd"),
function(a){var c=["b","i","u"],l=[],g=a.find(".title");a={id:_num(a.attr("val")),txt_7:a.find(".txt_7").val(),txt_8:a.find(".txt_8").val(),txt_9:a.find(".txt_9").val(),color:""};for(var e in c)g.hasClass(c[e])&&l.push(c[e]);a.font=l.join(" ");for(e in ELEM_COLOR)if(g.hasClass(e)){a.color=e;break}d.push(a)});return{act:c.srce.dop.act,v:d}},PHP12_elem_all_rule_setup_get=function(a,c){var d=[];_forEq(_attr_el(a.id).find("input"),function(a){var c=_num(a.attr("id").split("rule-el")[1]);a=_num(a.val());
c&&a&&d.push(c)});return{rule_id:c.get_id,ids:d.join()}},_noteCDel=function(a,c){var d={op:"note_comment_del",note_id:c,busy_cls:"spin",busy_obj:$(a)};_post(d,function(){$(a).parents("._comment-u").addClass("deleted")})},_noteCRest=function(a,c){var d={op:"note_comment_rest",note_id:c,busy_obj:$(a)};_post(d,function(){$(a).parents("._comment-u").removeClass("deleted")})},PHP12_page_access_for_user_setup=function(a,c,d){_forEq(_attr_el(a.id).find("._check"),function(a){var c=a.prev();c._check({func:function(a){c.parents("table").next()[a?
"slideDown":"slideUp"](200)}})})},PHP12_page_access_for_user_setup_get=function(a){var c=[];_forEq(_attr_el(a.id).find("._check"),function(a){a=a.prev();var b=_num(a.attr("id").split("_")[1]);_num(a.val())&&c.push(b)});return c.join(",")},PHP12_app_enter_for_all_user_get=function(a){var c=[];_forEq(_attr_el(a.id).find("._check"),function(a){a=a.prev();var b=_num(a.attr("id").split("_")[1]);_num(a.val())&&c.push(b)});return c.join(",")},PHP12_image_show=function(){var a=$("#_image-show").find(".iu"),
c=$("#_image-main"),d=c.height(),b=function(b){var l=IMG_ASS[b];a.removeClass("sel");c.html('<img src="'+l.src+'" width="'+l.x+'" height="'+l.y+'" />');c.attr("val",b);d<c.height()&&(d=c.height(),c.height(d));_forEq(a,function(a){if(_num(a.attr("val"))==b)return a.addClass("sel"),!1})};c.height(d);c.click(function(){if(IMG_IDS.length){var a=_num(c.attr("val"));_forN(IMG_IDS,function(c,d){if(c==a)return++d==IMG_IDS.length&&(d=0),b(IMG_IDS[d]),!1})}else DIALOG[65].close()});a.click(function(){var a=
$(this),a=_num(a.attr("val"));b(a)})},PHP12_dialog_app=function(a){_attr_el(a.id).find("ol.dialog-sort").nestedSortable({forcePlaceholderSize:!0,placeholder:"page-sort-hold",listType:"ol",items:"li",handle:".icon-move",isTree:1,maxLevels:3,tabSize:20,revert:200,start:function(a,d){$(d.placeholder).prev().hasClass("mb5")&&$(d.placeholder).addClass("mb5");$(d.placeholder).prev().hasClass("mb1")&&$(d.placeholder).addClass("mb1")},update:function(c,d){var b={op:"dialog_sort",arr:$(this).nestedSortable("toArray"),
busy_obj:_attr_el(a.id),busy_cls:"spisok-busy"};_post(b,function(){var a=$(d.item),b=a.parent().hasClass("dialog-sort");a.removeClass(b?"mb1":"mb5");a.addClass(b?"mb5":"mb1");a.find(".d-name:first")._dn(!b,"b")})},errorClass:"bg-fcc"})};
$(document).on("click",".dialog-open",function(){var a=$(this),c=a.attr("val"),d={busy_obj:a,busy_cls:a.hasClass("icon")?"spin":"_busy"};c&&(_forN(c.split(","),function(a){a=a.split(":");d[a[0]]=_num(a[1],1)}),_dialogLoad(d))}).on("click",".dialog-setup",function(){var a=$(this),c=a.attr("val"),d={op:"dialog_setup_load",busy_obj:a,busy_cls:a.hasClass("icon")?"spin":"_busy"};_forN(c.split(","),function(a){a=a.split(":");d[a[0]]=_num(a[1],1)});_post(d,_dialogSetup)}).on("click",".image-open",function(){var a=
$(this),c=a.attr("val");_dialogLoad({dialog_id:65,dop:c,busy_obj:a.parent()})});
